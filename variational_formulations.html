
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. Variational formulations for inverse problems &#8212; 10 Lectures on Inverse Problems and Imaging</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Numerical optimisation for inverse problems" href="numerical_optimisation.html" />
    <link rel="prev" title="4. A statistical perspective on inverse problems" href="statistical_perspective.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">10 Lectures on Inverse Problems and Imaging</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to Inverse Problems and Imaging
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="what_is.html">
   1. What is an inverse problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_ip_regularization.html">
   2. Discrete Inverse Problems and Regularisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ip_function_spaces.html">
   3. Linear inverse problems in function spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="statistical_perspective.html">
   4. A statistical perspective on inverse problems
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. Variational formulations for inverse problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numerical_optimisation.html">
   6. Numerical optimisation for inverse problems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="image_processing.html">
   7. Image processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tomography.html">
   8. Computed Tomography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wavefield_imaging.html">
   9. Wavefield Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic_resonance_imaging.html">
   10. Magnetic Resonance Imaging
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   11. Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/variational_formulations.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/variational_formulations.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        
        <a class="edit-button" href="https://github.com/TristanvanLeeuwen/IP_and_Im_Lectures/edit/master/variational_formulations.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/TristanvanLeeuwen/IP_and_Im_Lectures/master?urlpath=tree/variational_formulations.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   5.1. Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#existence-and-uniqueness">
     5.1.1. Existence and uniqueness
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#well-posedness-of-regularised-least-squares-problems">
     5.1.2. Well-posedness of regularised least-squares problems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examples">
     5.1.3. Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivatives">
   5.2. Derivatives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-euler-lagrange-equations">
   5.3. The Euler-Lagrange equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   5.4. Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#well-posedness-and-optimality-conditions">
     5.4.1. Well-posedness and optimality conditions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frechet-derivatives">
     5.4.2. Fréchet derivatives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#high-order-diffusion">
     5.4.3. High-order diffusion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assignments">
   5.5. Assignments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#total-variation">
     5.5.1. Total variation
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Variational formulations for inverse problems</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   5.1. Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#existence-and-uniqueness">
     5.1.1. Existence and uniqueness
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#well-posedness-of-regularised-least-squares-problems">
     5.1.2. Well-posedness of regularised least-squares problems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examples">
     5.1.3. Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivatives">
   5.2. Derivatives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-euler-lagrange-equations">
   5.3. The Euler-Lagrange equations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   5.4. Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#well-posedness-and-optimality-conditions">
     5.4.1. Well-posedness and optimality conditions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frechet-derivatives">
     5.4.2. Fréchet derivatives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#high-order-diffusion">
     5.4.3. High-order diffusion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assignments">
   5.5. Assignments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#total-variation">
     5.5.1. Total variation
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="variational-formulations-for-inverse-problems">
<h1><span class="section-number">5. </span>Variational formulations for inverse problems<a class="headerlink" href="#variational-formulations-for-inverse-problems" title="Permalink to this headline">¶</a></h1>
<p>So far, we have seen that inverse problems may generally be formulated as a variational problem</p>
<div class="math notranslate nohighlight" id="equation-variational">
<span class="eqno">(5.1)<a class="headerlink" href="#equation-variational" title="Permalink to this equation">¶</a></span>\[\min_{u\in\mathcal{U}} J(u),\]</div>
<p>where the <em>functional</em> <span class="math notranslate nohighlight">\(J : \mathcal{U} \rightarrow \mathbb{R}_{\infty}\)</span> consists of a <em>data-fidelity</em> and <em>regularisation</em> term. Here, <span class="math notranslate nohighlight">\(\mathbb{R}_{\infty} = \mathbb{R} \cup \{\infty\}\)</span> denotes the extended real line and <span class="math notranslate nohighlight">\(\mathcal{U}\)</span> is a Banach space.</p>
<p>In this chapter we will discuss how to analyse the well-posedness of <a class="reference internal" href="#equation-variational">(5.1)</a> and lay out the connection between variational problems and PDEs through the <em>gradient flow</em>. The contents of this chapter were heavily inspired by the excellent <a class="reference external" href="https://mehrhardt.github.io/data/201803_lecture_notes_invprob.pdf">lecture notes from Matthias J. Ehrhardt and Lukas F. Lang</a></p>
<hr class="docutils" />
<p>Some notable examples are highlighted below.</p>
<div class="admonition-example-box-constraints admonition">
<p class="admonition-title">Example: <em>box constraints</em></p>
<p>Given a forward operator <span class="math notranslate nohighlight">\(K \in \mathbb{R}^{n\times n}\)</span> we can look for a solution in <span class="math notranslate nohighlight">\([0,1]^n\)</span> by solving a constrained minimisation problem</p>
<div class="math notranslate nohighlight">
\[\min_{u\in [0,1]^n} \|Ku - f^\delta\|_2^2.\]</div>
<p>However, this does not fall in the class <a class="reference internal" href="#equation-variational">(5.1)</a> since <span class="math notranslate nohighlight">\([0,1]^n\)</span> is not a vectorspace. To circumvent this we can alternatively express it as</p>
<div class="math notranslate nohighlight">
\[\min_{u\in \mathbb{R}^n} \|Ku - f^\delta\|_2^2 + \delta_{[0,1]^n}(u),\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta_{\mathcal{C}}\)</span> denotes the <a class="reference external" href="https://en.wikipedia.org/wiki/Characteristic_function_(convex_analysis)">characteristic function</a> of the set <span class="math notranslate nohighlight">\(\mathcal{C}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\delta_{\mathcal{C}}(u) = \begin{cases} 0 &amp; u \in \mathcal{C} \\ \infty &amp; \text{otherwise}\end{cases}.\end{split}\]</div>
<p>The corresponding functional <span class="math notranslate nohighlight">\(J\)</span> now takes values in the extended real line.</p>
</div>
<div class="admonition-example-sobolev-regularisation admonition">
<p class="admonition-title">Example: <em>Sobolev regularisation</em></p>
<p>Given a bounded linear operator <span class="math notranslate nohighlight">\(K:H^1(\Omega)\rightarrow L^2(\Omega)\)</span> and data <span class="math notranslate nohighlight">\(f^\delta\)</span>, we let <span class="math notranslate nohighlight">\(\nabla\)</span> denote the gradient</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku-f^{\delta}\|_{L^2(\Omega)}^2 +  \textstyle{\frac{\alpha}{2}}\|\nabla u\|_{L^2(\Omega)}^2.\]</div>
<p>This functional is well-defined for <span class="math notranslate nohighlight">\(u \in H^1(\Omega)\)</span>, with <span class="math notranslate nohighlight">\(H^1(\Omega)\)</span> denoting the <a class="reference external" href="https://en.wikipedia.org/wiki/Sobolev_space">Sobolev space</a> of functions <span class="math notranslate nohighlight">\(u\)</span> for which both <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(\nabla u\)</span> are square integrable. Thus, this type of regularisation generally leads to smooth solutions.</p>
</div>
<div class="admonition-example-ell-1-regularization admonition">
<p class="admonition-title">Example: <em><span class="math notranslate nohighlight">\(\ell_1\)</span>-regularization</em></p>
<p>Consider a forward operator <span class="math notranslate nohighlight">\(K:\ell_1 \rightarrow \ell_2\)</span> and let</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku - f^\delta\|_{\ell_2}^2 + \alpha \|u\|_{\ell_1}.\]</div>
<p>Such regularisation is often used to promote <em>sparse</em> solutions.</p>
</div>
<div class="admonition-example-total-variation-regularisation admonition">
<p class="admonition-title">Example: <em>Total Variation regularisation</em></p>
<p>Consider recovering a function <span class="math notranslate nohighlight">\(u: [0,1] \rightarrow \mathbb{R}\)</span> from noisy measurements <span class="math notranslate nohighlight">\(f^\delta = Ku + e\)</span>. A popular choice in imaging applications is to put an <span class="math notranslate nohighlight">\(L^1\)</span>-norm on the derivative. For <span class="math notranslate nohighlight">\(u\in W^{1,1}([0,1])\)</span> this yields</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku-f^{\delta}\|_{L^2([0,1])}^2 + \alpha \|u'\|_{L^1([0,1])}.\]</div>
<p>This can be generalised to include certain discontinuous functions by introducing the space of functions of <a class="reference external" href="https://en.wikipedia.org/wiki/Bounded_variation">bounded variation</a>, denoted by <span class="math notranslate nohighlight">\(BV([0,1])\)</span>. Functions in <span class="math notranslate nohighlight">\(BV([0,1])\)</span> are characterised as having a finite <a class="reference external" href="https://en.wikipedia.org/wiki/Total_variation">Total Variation</a></p>
<div class="math notranslate nohighlight">
\[TV(u) = \sup_{\phi \in D([0,1],\mathbb{R})} \int_0^1 u(x)\phi'(x)\mathrm{d}x,\]</div>
<p>where <span class="math notranslate nohighlight">\(D([0,1],\mathbb{R})\)</span> is the space of smooth test functions with <span class="math notranslate nohighlight">\(\|\phi\|_{L^\infty([0,1])}\leq 1\)</span>. The space <span class="math notranslate nohighlight">\(BV([0,1])\)</span> is much larger than <span class="math notranslate nohighlight">\(W^{1,1}([0,1])\)</span> as it contains certain discontinuous functions (such as the Heaviside stepfunction) and smaller than <span class="math notranslate nohighlight">\(L^1(0,1)\)</span> (which also contains less regular functions). For functions in <span class="math notranslate nohighlight">\(W^{1,1}\)</span> we have <span class="math notranslate nohighlight">\(TV(u) = \|u'\|_{L^1([0,1])}\)</span>.</p>
</div>
<div class="section" id="analysis">
<h2><span class="section-number">5.1. </span>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="existence-and-uniqueness">
<h3><span class="section-number">5.1.1. </span>Existence and uniqueness<a class="headerlink" href="#existence-and-uniqueness" title="Permalink to this headline">¶</a></h3>
<p>To establish existence of minimisers, we first need a few definitions. Firstly, what <em>is</em> a minimiser?</p>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Minimisers</em></p>
<p>We say that <span class="math notranslate nohighlight">\(\widetilde{u} \in \mathcal{U}\)</span> solves <a class="reference internal" href="#equation-variational">(5.1)</a> iff <span class="math notranslate nohighlight">\(J(\widetilde{u}) &lt; \infty\)</span> and <span class="math notranslate nohighlight">\(J(\widetilde{u}) \leq J(u)\)</span> for all <span class="math notranslate nohighlight">\(u \in \mathcal{U}\)</span>.</p>
</div>
<p>Then, we need some definitions regarding the properties of the functional <span class="math notranslate nohighlight">\(J\)</span>.</p>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Proper functionals</em></p>
<p>A functional <span class="math notranslate nohighlight">\(J\)</span> is called proper if its effective domain <span class="math notranslate nohighlight">\(\text{dom}(J) = \{u\in\mathcal{U} \, | \, J(u) &lt; \infty\}\)</span> is not empty.</p>
</div>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Bounded from below</em></p>
<p>A functional <span class="math notranslate nohighlight">\(J\)</span> is bounded from below if there exists a constant <span class="math notranslate nohighlight">\(C &gt; -\infty\)</span> such that <span class="math notranslate nohighlight">\(\forall u\in \mathcal{U}\)</span> we have <span class="math notranslate nohighlight">\(J(u) \geq C\)</span>.</p>
</div>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Coercive functionals</em></p>
<p>A functional <span class="math notranslate nohighlight">\(J\)</span> is called coercive if <span class="math notranslate nohighlight">\(J(u) \rightarrow\infty\)</span> as <span class="math notranslate nohighlight">\(\|u\|_{\mathcal{U}} \rightarrow \infty\)</span>.</p>
</div>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Lower semi-continuity</em></p>
<p>A functional <span class="math notranslate nohighlight">\(J\)</span> is lower semi-continuous at <span class="math notranslate nohighlight">\(u\)</span> if for every <span class="math notranslate nohighlight">\(a &lt; J(u)\)</span> there exists a neighbourhood <span class="math notranslate nohighlight">\(\mathcal{X}\)</span> of <span class="math notranslate nohighlight">\(u\)</span> such that <span class="math notranslate nohighlight">\(a &lt; J(v)\)</span> for all <span class="math notranslate nohighlight">\(v \in \mathcal{X}\)</span>.</p>
<p>An alternative (slightly weaker) notion is <em>sequential</em> lower semi-continuity, which requires that</p>
<div class="math notranslate nohighlight">
\[J(u) \leq \lim\inf_{k\rightarrow \infty} J(u_k),\]</div>
<p>for all sequences <span class="math notranslate nohighlight">\(\{u_k\}_{k\in\mathbb{N}}\)</span> with <span class="math notranslate nohighlight">\(u_k \rightarrow u\)</span> as <span class="math notranslate nohighlight">\(k\rightarrow\infty\)</span>.</p>
<p>Note that the term <em>neighbourhood</em> and the notion of convergence <span class="math notranslate nohighlight">\(u_k\rightarrow u\)</span> require the definition an underlying topology, which may be different (in particular, weaker) than the one induced by the norm on <span class="math notranslate nohighlight">\(\mathcal{U}\)</span>.</p>
</div>
<p>With these, we can establish existence.</p>
<div class="important admonition">
<p class="admonition-title">Theorem: <em>Fundamental theorem of optimisation</em></p>
<p>Let <span class="math notranslate nohighlight">\(J : \mathcal{U} \rightarrow \mathbb{R}\)</span> be proper, coercive, bounded from below and sequential lower semi-continuous. Then <span class="math notranslate nohighlight">\(J\)</span> has a minimiser.</p>
</div>
<div class="important dropdown admonition">
<p class="admonition-title">Proof:</p>
<p>The first step is to establish the existence of minimising sequences <span class="math notranslate nohighlight">\(\{u_k\}_{k\in\mathbb{N}}\)</span>, i.e., <span class="math notranslate nohighlight">\(J(u_k) \rightarrow \inf_u J(u)\)</span> and showing that these are bounded. We’ll use the fact that <span class="math notranslate nohighlight">\(J\)</span> is proper, coercive and bounded from below.</p>
<p>Then, we need to establish that there exists a subsequence <span class="math notranslate nohighlight">\(\{u_{j_k}\}_{k\in\mathbb{N}}\)</span> of a minimising sequence and a <span class="math notranslate nohighlight">\(u_*\)</span> such that <span class="math notranslate nohighlight">\(u_{j_k} \rightarrow u_*\)</span>. Here, we’ll use the underlying topology.</p>
<p>Finally, we use the fact that <span class="math notranslate nohighlight">\(J\)</span> is l.s.c. (w.r.t. the chosen topology) to show that <span class="math notranslate nohighlight">\(u_*\)</span> is a minimiser.</p>
</div>
<p>While this theorem is quite general, establishing that <span class="math notranslate nohighlight">\(J\)</span> has the required properties can be difficult in practice. In particular, it may involve detailed knowledge of functional analysis in Banach spaces. We will not treat these in general, but instead give some illustrative examples.</p>
<div class="admonition-examples-existence-of-minimisers-in-mathbb-r admonition">
<p class="admonition-title">Examples: <em>existence of minimisers in <span class="math notranslate nohighlight">\(\mathbb{R}\)</span></em></p>
<p>Consider the following functions <span class="math notranslate nohighlight">\(J:\mathbb{R}\rightarrow \mathbb{R}\)</span> (cf. <a class="reference internal" href="#functionals"><span class="std std-numref">Fig. 5.1</span></a>):</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(J_1(x) = x^3,\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(J_2(x) = e^x,\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(J_3(x) = \begin{cases}x^2 &amp; x &lt; 0 \\ 1 + x &amp; x \geq 0\end{cases}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(J_4(x) = \begin{cases}x^2 &amp; x \leq 0 \\ 1 + x &amp; x &gt; 0\end{cases}\)</span></p></li>
</ul>
<p>We see that <span class="math notranslate nohighlight">\(J_1\)</span> is not bounded from below; <span class="math notranslate nohighlight">\(J_2\)</span> is not coercive, <span class="math notranslate nohighlight">\(J_3\)</span> is not l.s.c while <span class="math notranslate nohighlight">\(J_4\)</span> is.</p>
<div class="figure align-default" id="functionals" style="width: 500px">
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_1_0.png" src="_images/variational_formulations_1_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 5.1 </span><span class="caption-text">Examples of various functions.</span><a class="headerlink" href="#functionals" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="c1"># grid</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">30</span><span class="p">:],</span><span class="n">x</span><span class="p">[</span><span class="mi">30</span><span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">30</span><span class="p">:],</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">30</span><span class="p">:],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;functionals&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_1_1.png" src="_images/variational_formulations_1_1.png" />
</div>
</div>
<div class="admonition-example-non-coercive-least-squares admonition">
<p class="admonition-title">Example: <em>non-coercive least-squares</em></p>
<p>Consider <span class="math notranslate nohighlight">\(J(u) = \|Ku - f\|_2^2\)</span> with <span class="math notranslate nohighlight">\(K : \ell_2 \rightarrow \ell_2\)</span> defined as <span class="math notranslate nohighlight">\((Ku)_i = i^{-1} u_i\)</span>
and <span class="math notranslate nohighlight">\(f_i = i^{-1}\)</span>.</p>
<p><span class="math notranslate nohighlight">\(J\)</span> is not coercive since for the sequence <span class="math notranslate nohighlight">\(\{(1,0,0,\ldots),(1,1,0,\ldots), \ldots\}\)</span> we have <span class="math notranslate nohighlight">\(\|u_k\|_2 \rightarrow \infty\)</span> but <span class="math notranslate nohighlight">\(J(u_k) \rightarrow 0\)</span>.</p>
</div>
<div class="admonition-example-lower-semi-continuity-of-tv admonition">
<p class="admonition-title">Example: <em>Lower semi-continuity of TV</em></p>
<p>The total-variation functional</p>
<div class="math notranslate nohighlight">
\[TV(u) = \sup_{\phi \in D([0,1],\mathbb{R})} \int_0^1 u(x)\phi'(x)\mathrm{d}x,\]</div>
<p>is l.s.c. w.r.t. <span class="math notranslate nohighlight">\(L^1\)</span>. To see this, consider a sequence <span class="math notranslate nohighlight">\(\{u_k\}_{k\in\mathbb{N}}\)</span> of functions of bounded variation, with <span class="math notranslate nohighlight">\(\|u_k - u\|_{L^1} \rightarrow 0\)</span>. Then, for any test function <span class="math notranslate nohighlight">\(\phi \in D([0,1],\mathbb{R})\)</span> we have</p>
<div class="math notranslate nohighlight">
\[\left|\int_0^1 (u_k(x) - u(x))\phi'(x)\mathrm{d}x\right| \leq \|u_k - u\|_{L^1([0,1])} \|\phi'\|_{L^\infty([0,1])}.\]</div>
<p>Thus</p>
<div class="math notranslate nohighlight">
\[TV(u) \leq \lim\inf_{k\rightarrow \infty} TV(u_k),\]</div>
<p>showing that <span class="math notranslate nohighlight">\(TV(u)\)</span> is (continuous and hence) indeed l.s.c. w.r.t. <span class="math notranslate nohighlight">\(L^1([0,1])\)</span>.</p>
</div>
<p>Having established existence, we can wonder about uniqueness. The following theorem gives a sufficient (but not necessary!) condition for uniqueness.</p>
<div class="important admonition">
<p class="admonition-title">Theorem: <em>Uniqueness of minimisers</em></p>
<p>Let <span class="math notranslate nohighlight">\(J\)</span> have at least one minimiser and be <a class="reference external" href="https://en.wikipedia.org/wiki/Convex_function">strictly convex</a> then the minimiser is unique.</p>
</div>
<div class="important dropdown admonition">
<p class="admonition-title">Proof:</p>
<p>Let <span class="math notranslate nohighlight">\(u_1, u_2\)</span> be two distinct minimisers; i.e. <span class="math notranslate nohighlight">\(J(u_i) \leq J(u) \forall u \in \mathcal{U}\)</span>. In particular, we have <span class="math notranslate nohighlight">\(J(u_1) \leq J(\alpha u_1 + \beta u_2)\)</span> with <span class="math notranslate nohighlight">\(\alpha + \beta = 1\)</span>. Because <span class="math notranslate nohighlight">\(J\)</span> is strictly convex</p>
<div class="math notranslate nohighlight">
\[J(\alpha u_1 + \beta u_2) &lt; \alpha J(u_1) + \beta J(u_2),\]</div>
<p>which would lead to a contradiction: <span class="math notranslate nohighlight">\(J(u_1) &lt; J(u_1)\)</span>.</p>
</div>
</div>
<div class="section" id="well-posedness-of-regularised-least-squares-problems">
<h3><span class="section-number">5.1.2. </span>Well-posedness of regularised least-squares problems<a class="headerlink" href="#well-posedness-of-regularised-least-squares-problems" title="Permalink to this headline">¶</a></h3>
<p>In this section we focus in particular on variational problems of the form</p>
<div class="math notranslate nohighlight" id="equation-variational-r">
<span class="eqno">(5.2)<a class="headerlink" href="#equation-variational-r" title="Permalink to this equation">¶</a></span>\[\textstyle{\frac{1}{2}}\|Ku - f^\delta\|_{\mathcal{F}}^2 + \alpha R(u),\]</div>
<p>with <span class="math notranslate nohighlight">\(K: \mathcal{U} \rightarrow \mathcal{F}\)</span> a bounded linear operator and <span class="math notranslate nohighlight">\(R : \mathcal{U} \rightarrow \mathbb{R}_{\infty}\)</span> is proper and l.s.c. (with respect to an appropriate topology).</p>
<p>We can think of <a class="reference internal" href="#equation-variational-r">(5.2)</a> as defining a (possibly non-linear) regularisation scheme <span class="math notranslate nohighlight">\(\widetilde{u}_{\alpha,\delta} = K_{\alpha}^\dagger(f^\delta)\)</span> that generalises the pseudo-inverse approach discussed earlier. Note that the notation <span class="math notranslate nohighlight">\(K_{\alpha}^\dagger\)</span> is used very loosely to indicate a mapping from <span class="math notranslate nohighlight">\(\mathcal{F}\)</span> to <span class="math notranslate nohighlight">\(\mathcal{U}\)</span> that is supposed to approximate the inverse of <span class="math notranslate nohighlight">\(K\)</span> by solving <a class="reference internal" href="#equation-variational-r">(5.2)</a>. In general, this will be a non-linear mapping.</p>
<p>Conditions under which the operator <span class="math notranslate nohighlight">\(K_{\alpha}^\dagger\)</span> is well-defined and continuous can be stated quite generally. Similarly, conditions under which the regularised solution converges to the usual pseudo-inverse solution can be stated. This goes beyond the scope of these lecture notes. The interested reader is referred to <a class="reference external" href="https://mehrhardt.github.io/data/201803_lecture_notes_invprob.pdf">the lecture notes from Matthias J. Ehrhardt and Lukas F. Lang</a>.</p>
</div>
<div class="section" id="examples">
<h3><span class="section-number">5.1.3. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="admonition-example-tikhonov-regularisation-in-mathbb-r-n admonition">
<p class="admonition-title">Example: <em>Tikhonov regularisation in <span class="math notranslate nohighlight">\(\mathbb{R}^n\)</span></em></p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku - f^\delta\|_2^2 + \textstyle{\frac{\alpha}{2}}\|u\|_2^2.\]</div>
<p>Here, <span class="math notranslate nohighlight">\(J\)</span> is obviously bounded from below and proper. To show that <span class="math notranslate nohighlight">\(J\)</span> is coercive, we note that <span class="math notranslate nohighlight">\(J(u) \geq \textstyle{\frac{\alpha}{2}}\|u\|_2^2\)</span> and hence that <span class="math notranslate nohighlight">\(J(u) \rightarrow \infty\)</span> as <span class="math notranslate nohighlight">\(\|u\|_2 \rightarrow \infty\)</span>. To show that <span class="math notranslate nohighlight">\(J\)</span> is l.s.c., we will show that <span class="math notranslate nohighlight">\(J\)</span> is continuous since this implies l.s.c. First note that</p>
<div class="math notranslate nohighlight">
\[J(u + d) = J(u) + \textstyle{\frac{1}{2}}\|Kd\|_2^2 - \langle Kd,Ku - f^\delta \rangle + \textstyle{\frac{\alpha}{2}}\|d\|_2^2 + \alpha \langle d,u\rangle,\]</div>
<p>from which we can bound</p>
<div class="math notranslate nohighlight">
\[|J(u+d) - J(u)| \leq A \|d\|_2^2 + B \|d\|_2.\]</div>
<p>Now, for every <span class="math notranslate nohighlight">\(\epsilon\)</span> we can pick a <span class="math notranslate nohighlight">\(\delta\)</span> such that <span class="math notranslate nohighlight">\(\|d\|_2 &lt; \delta\)</span> implies that <span class="math notranslate nohighlight">\(|J(u+d) - J(u)| &lt; \epsilon\)</span>.</p>
<p>Finally, we can show that <span class="math notranslate nohighlight">\(J\)</span> is <em>strongly convex</em> with constant <span class="math notranslate nohighlight">\(\alpha\)</span> by showing that <span class="math notranslate nohighlight">\(J(u) - \textstyle{\frac{\alpha}{2}}\|u\|_2^2\)</span> is convex. The fact that <span class="math notranslate nohighlight">\(\|Ku - f^\delta\|_2^2\)</span> is convex follows easily from the triangle inequality and the fact that the function <span class="math notranslate nohighlight">\((\cdot)^2\)</span> is convex.</p>
</div>
<div class="admonition-example-ell-1-regularisation admonition">
<p class="admonition-title">Example: <em><span class="math notranslate nohighlight">\(\ell_1-regularisation\)</span></em></p>
<p>Consider</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku - f^\delta\|_{\ell_2}^2 + \alpha \|u\|_{\ell_1},\]</div>
<p>with <span class="math notranslate nohighlight">\(K : \ell_2 \rightarrow \ell_2\)</span> a bounded operator. Again, we can easily see that <span class="math notranslate nohighlight">\(J\)</span> is bounded from below.</p>
<p>Note that the regularised solution is determined for all <span class="math notranslate nohighlight">\(f^\delta \in \ell_2\)</span>, regardless of the Picard condition.</p>
</div>
<div class="admonition-example-sobolev-regularisation admonition">
<p class="admonition-title">Example: <em>Sobolev regularisation</em></p>
<p>Consider</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku - f^\delta\|_{L^2(\Omega)}^2 + \textstyle{\frac{\alpha}{2}}\|\nabla u\|_{L^2(\Omega)}^2.\]</div>
</div>
<div class="admonition-example-total-variation-regularisation admonition">
<p class="admonition-title">Example: <em>Total variation regularisation</em></p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[J(u) = \textstyle{\frac{1}{2}}\|Ku - f^\delta\|_{L^2(\Omega)}^2 + \alpha TV(u).\]</div>
</div>
</div>
</div>
<div class="section" id="derivatives">
<h2><span class="section-number">5.2. </span>Derivatives<a class="headerlink" href="#derivatives" title="Permalink to this headline">¶</a></h2>
<p>Having established well-posedness of <a class="reference internal" href="#equation-variational">(5.1)</a>, we now focus our attention to characterising solutions through the first-order optimality conditions.</p>
<div class="important admonition">
<p class="admonition-title">Definition: <em>Fréchet derivative</em></p>
<p>We call a functional <span class="math notranslate nohighlight">\(J:\mathcal{U}\rightarrow \mathbb{R}\)</span> Fréchet differentiable (at <span class="math notranslate nohighlight">\(u\)</span>) if
there exists a linear operator <span class="math notranslate nohighlight">\(D\)</span> such that</p>
<div class="math notranslate nohighlight" id="equation-frechet">
<span class="eqno">(5.3)<a class="headerlink" href="#equation-frechet" title="Permalink to this equation">¶</a></span>\[\lim_{h\rightarrow 0} \frac{|J(u+h) - J(u) - Dh|}{\|h\|_{\mathcal{U}}} = 0.\]</div>
<p>If this operator exists for all <span class="math notranslate nohighlight">\(u \in\mathcal{U}\)</span> we call <span class="math notranslate nohighlight">\(J\)</span> Fréchet differentiable and denote its Fréchet derivative by <span class="math notranslate nohighlight">\(J': \mathcal{U} \rightarrow \mathcal{U}^*\)</span>. Here, <span class="math notranslate nohighlight">\(\mathcal{U}^*\)</span> denotes the <a class="reference external" href="https://en.wikipedia.org/wiki/Dual_space">dual space</a> of <span class="math notranslate nohighlight">\(\mathcal{U}\)</span> which consists of bounded linear functionals on <span class="math notranslate nohighlight">\(\mathcal{U}\)</span>.</p>
</div>
<p>With this more general notion of differentiation we can pose the first-order optimality conditions.</p>
<div class="important admonition">
<p class="admonition-title">Definition: <em>First-order optimality condition</em></p>
<p>Let <span class="math notranslate nohighlight">\(u_*\)</span> be a local extremum of <span class="math notranslate nohighlight">\(J\)</span>, and let <span class="math notranslate nohighlight">\(J\)</span> be Fréchet-differentiable at <span class="math notranslate nohighlight">\(u_*\)</span>, then</p>
<div class="math notranslate nohighlight" id="equation-local-extremum">
<span class="eqno">(5.4)<a class="headerlink" href="#equation-local-extremum" title="Permalink to this equation">¶</a></span>\[J'(u_*) = 0.\]</div>
</div>
<div class="admonition-example-tikhonov-regularisation-on-mathbb-r-n admonition">
<p class="admonition-title">Example: <em>Tikhonov regularisation on \mathbb{R}^n</em></p>
<p>…</p>
</div>
<p>Note that in some important cases <span class="math notranslate nohighlight">\(J\)</span> may fail to be Fréchet differentiable at the solution. We will treat this case in more detail in the next chapter on numerical methods.</p>
<div class="admonition-example-ell-1-regularisation-on-mathbb-r-n admonition">
<p class="admonition-title">Example: <em><span class="math notranslate nohighlight">\(\ell_1\)</span>-regularisation on \mathbb{R}^n</em></p>
<p>…</p>
</div>
<hr class="docutils" />
<p>A well-known method for solving <a class="reference internal" href="#equation-variational">(5.1)</a> is the <em>Landweber</em> iteration</p>
<div class="math notranslate nohighlight">
\[u_{k+1} = u_k - \lambda J'(u_k),\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda &gt; 0\)</span> denotes the stepsize. Under certain conditions on <span class="math notranslate nohighlight">\(J'(u)\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span> one can show that this converges to a stationary point <span class="math notranslate nohighlight">\(u_{*}\)</span> for which <span class="math notranslate nohighlight">\(J'(u_*) = 0\)</span>. Obviously, this method only applies when <span class="math notranslate nohighlight">\(J'(u)\)</span> is well-defined everywhere along the solution path.</p>
<hr class="docutils" />
<p>It turns out that we can make an important distinction between <em>smooth</em> and <em>convex</em> (non-smooth) functionals.
We will explore optimality conditions and algorithms for these two classes in more detail in a later chapter.</p>
</div>
<div class="section" id="the-euler-lagrange-equations">
<h2><span class="section-number">5.3. </span>The Euler-Lagrange equations<a class="headerlink" href="#the-euler-lagrange-equations" title="Permalink to this headline">¶</a></h2>
<p>An alternative viewpoint on optimality is provided by the Euler-lagrange equations, which establishes the link between certain problems of the form <a class="reference internal" href="#equation-variational">(5.1)</a> and PDEs. In particular, we focus in this section on functionals of the form</p>
<div class="math notranslate nohighlight" id="equation-j-denoising">
<span class="eqno">(5.5)<a class="headerlink" href="#equation-j-denoising" title="Permalink to this equation">¶</a></span>\[J(u) = {\textstyle{\frac{1}{2}}} \int_{\Omega} \left(u(x) - f^\delta(x)\right)^2 + r(\nabla u(x)) \mathrm{d}x,\]</div>
<p>with <span class="math notranslate nohighlight">\(\Omega \subset \mathbb{R}^n\)</span> and <span class="math notranslate nohighlight">\(r : \mathbb{R}^n \rightarrow \mathbb{R}\)</span>. Such problems occur for example in image-denoising applications. We will see later that such problems also occur as subproblems when solving more general problems of the form <a class="reference internal" href="#equation-variational-r">(5.2)</a>.</p>
<div class="important admonition">
<p class="admonition-title">Theorem: Euler-Lagrange equations</p>
<p>Let <span class="math notranslate nohighlight">\(J\)</span> be a functional of the form <a class="reference internal" href="#equation-j-denoising">(5.5)</a>. Then the Euler-Lagrange equations are given by</p>
<div class="math notranslate nohighlight">
\[u(x) - \nabla \cdot \left(\nabla r(\nabla u(x))\right) = f^\delta(x),\]</div>
<p>with boundary condition <span class="math notranslate nohighlight">\(\nabla r( \nabla u) \cdot n = 0\)</span>. Here <span class="math notranslate nohighlight">\(n(x)\)</span> denotes the normal at <span class="math notranslate nohighlight">\(x \in \partial \Omega\)</span> and <span class="math notranslate nohighlight">\(\nabla r\)</span> denotes the gradient with respect to its argument (and not with respect to <span class="math notranslate nohighlight">\(x\)</span>). The solution to this PDE is a stationary point of the functional <span class="math notranslate nohighlight">\(J\)</span>.</p>
<p>It is commonly expressed as an evolution equation</p>
<div class="math notranslate nohighlight">
\[\partial_t u(t,x) + u(t,x) - \nabla \cdot \left(\nabla r(\nabla u(t,x))\right) = f^\delta(x),\]</div>
<p>whose solution tends to a stationary point of <span class="math notranslate nohighlight">\(J\)</span> as <span class="math notranslate nohighlight">\(t \rightarrow \infty\)</span>.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Proof</p>
<p>Let <span class="math notranslate nohighlight">\(u_*\)</span> be stationary point of <span class="math notranslate nohighlight">\(J\)</span>, and introduce</p>
<div class="math notranslate nohighlight">
\[\phi(t) = J(u_* + t v),\]</div>
<p>then <span class="math notranslate nohighlight">\(\phi'(0) = 0\)</span> for all <span class="math notranslate nohighlight">\(v\)</span>. In this case we have</p>
<div class="math notranslate nohighlight">
\[\phi(t) = \int_{\Omega} \textstyle{\frac{1}{2}}\left(u + t v - f^\delta\right)^2 + r(\nabla u + t \nabla v),\]</div>
<p>and hence</p>
<div class="math notranslate nohighlight">
\[\phi'(0) = \int_{\Omega} (u - f^\delta)v + \nabla r(\nabla u)\cdot\nabla v.\]</div>
<p>Applying <a class="reference external" href="https://en.wikipedia.org/wiki/Green%27s_identities#Green%27s_first_identity">Green’s first identity</a> yields</p>
<div class="math notranslate nohighlight">
\[\int_{\Omega} \left(u(x) - f^\delta(x) - \nabla \cdot \left( \nabla r(\nabla u(x))\right)\right) v(x) \mathrm{d}x + \left.v(x)\nabla r( \nabla u(x))\cdot n(x)\right|_{\Omega}.\]</div>
<p>Since it should hold for all <span class="math notranslate nohighlight">\(v\)</span>, we obtain the desired PDE. The boundary term involves <span class="math notranslate nohighlight">\(\nabla r( \nabla u) \cdot n\)</span>, so this imposes <span class="math notranslate nohighlight">\(\nabla r( \nabla u) \cdot n = 0\)</span>.</p>
</div>
<div class="admonition-example-the-heat-equation admonition">
<p class="admonition-title">Example: <em>The heat equation</em></p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[r(v) = \|v\|_2^2.\]</div>
<p>The corresponding diffusion equation is given by</p>
<div class="math notranslate nohighlight">
\[\partial_t u + u - \alpha\nabla^2 u = f^\delta.\]</div>
<p>A forward Euler discretisation of the PDE leads to</p>
<div class="math notranslate nohighlight">
\[u_{k+1} = u_k - \Delta t \left(f^\delta - u + \alpha \nabla^2 u\right),\]</div>
<p>which is in fact a Landweber iteration applied to the corresponding objective.</p>
<div class="figure align-default" id="linear-diffusion" style="width: 500px">
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_3_0.png" src="_images/variational_formulations_3_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 5.2 </span><span class="caption-text">Example of denoising with linear diffusion.</span><a class="headerlink" href="#linear-diffusion" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">skimage.util</span> <span class="kn">import</span> <span class="n">random_noise</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span>

<span class="c1"># parameters</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">niter</span> <span class="o">=</span> <span class="mi">1001</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">coeff</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">s</span>

<span class="c1"># diffusion operator</span>
<span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">coeff</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">s</span><span class="p">):</span>
    <span class="n">ue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span> <span class="c1"># padd edges to get array of size n+2 x n+2</span>

    <span class="c1"># diffusion coefficient (central differences)</span>
    <span class="n">grad_norm</span> <span class="o">=</span> <span class="p">((</span><span class="n">ue</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ue</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">grad_norm</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>

    <span class="c1"># diffusion term (combination of forward and backward differences)</span>
    <span class="n">uxx</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">uyy</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">,]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uxx</span> <span class="o">+</span> <span class="n">uyy</span>

<span class="c1"># noisy image</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">(),(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">f_delta</span> <span class="o">=</span> <span class="n">random_noise</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># solve evolution equation</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">L</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">coeff</span><span class="p">))</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">f_delta</span>

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_delta</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy image&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Result&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;linear_diffusion&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_3_1.png" src="_images/variational_formulations_3_1.png" />
</div>
</div>
<div class="admonition-example-non-linear-diffusion admonition">
<p class="admonition-title">Example: <em>Non-linear diffusion</em></p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[r(v) = \log(1 + \|v\|_2^2/\epsilon^2),\]</div>
<p>which leads to the Perona-Malik diffusion equation:</p>
<div class="math notranslate nohighlight">
\[\partial_t u + u - \alpha\nabla \cdot \left(\frac{\nabla u}{1 + \epsilon^{-2}\|\nabla u\|_2^2}\right) = f^\delta.\]</div>
<p>We can interpret intuitively why this would preserve edges by looking at the diffusion coefficient. Wherever <span class="math notranslate nohighlight">\(\|\nabla u\| \ll \epsilon\)</span> we have linear diffusion, if <span class="math notranslate nohighlight">\(\|\nabla u\| \gg \epsilon\)</span>, we hardly have any diffusion. This intuition is confirmed by considering the penalty <span class="math notranslate nohighlight">\(r(s)\)</span>, which for small <span class="math notranslate nohighlight">\(s\)</span> behaves like <span class="math notranslate nohighlight">\(s^2\)</span> but then flattens out and will thus not increasingly penalise larger gradients.</p>
<div class="figure align-default" id="perona-malik" style="width: 500px">
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_5_0.png" src="_images/variational_formulations_5_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 5.3 </span><span class="caption-text">Example of denoising with Perona-Malik regularisation.</span><a class="headerlink" href="#perona-malik" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">skimage.util</span> <span class="kn">import</span> <span class="n">random_noise</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span>

<span class="c1"># parameters</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">niter</span> <span class="o">=</span> <span class="mi">1001</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">coeff</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e6</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># diffusion operator</span>
<span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">coeff</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span> <span class="p">:</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">ue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span> <span class="c1"># padd edges to get array of size n+2 x n+2</span>

    <span class="c1"># diffusion coefficient (central differences)</span>
    <span class="n">grad_norm</span> <span class="o">=</span> <span class="p">((</span><span class="n">ue</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ue</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">grad_norm</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>

    <span class="c1"># diffusion term (combination of forward and backward differences)</span>
    <span class="n">uxx</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">uyy</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ue</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">,]))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uxx</span> <span class="o">+</span> <span class="n">uyy</span>

<span class="c1"># noisy image</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">(),(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">f_delta</span> <span class="o">=</span> <span class="n">random_noise</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># solve evolution equation</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">niter</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">alpha</span><span class="o">*</span><span class="n">L</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">coeff</span><span class="p">))</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">f_delta</span>

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_delta</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Noisy image&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Result&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;perona_malik&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_5_1.png" src="_images/variational_formulations_5_1.png" />
</div>
</div>
</div>
<div class="section" id="exercises">
<h2><span class="section-number">5.4. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<div class="section" id="well-posedness-and-optimality-conditions">
<h3><span class="section-number">5.4.1. </span>Well-posedness and optimality conditions<a class="headerlink" href="#well-posedness-and-optimality-conditions" title="Permalink to this headline">¶</a></h3>
<p>The following functionals are given (for <span class="math notranslate nohighlight">\(\alpha &gt; 0\)</span> and <span class="math notranslate nohighlight">\(A \in \mathbb{R}^{2 \times 2}\)</span> an invertible matrix):</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(J_1: \mathbb{R} \rightarrow \mathbb{R}, u \mapsto \frac{1}2(u-f)^2 + \alpha|u|\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(J_2: \mathbb{R} \rightarrow \mathbb{R}, u \mapsto |u-f| + \alpha u^2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(J_3: \mathbb{R}^2 \rightarrow \mathbb{R}, u \mapsto \frac{1}2\Vert A u - f\Vert_{\ell^2}^2  + \alpha \Vert u \Vert_{\ell^2}\)</span></p></li>
</ul>
<p>Show that a minimum exists (use the fundamental theorem of optimisation) and that it is unique.</p>
</div>
<div class="section" id="frechet-derivatives">
<h3><span class="section-number">5.4.2. </span>Fréchet derivatives<a class="headerlink" href="#frechet-derivatives" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(\Omega \subset \mathbb{R}^2\)</span> and <span class="math notranslate nohighlight">\(\Sigma \subset \mathbb{R}^2\)</span>. Compute the Fréchet derivatives of the following functionals:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(J(u) = \frac{1}{2} \left\| \nabla u \right\|_{L^2(\Omega)}^2\)</span> where <span class="math notranslate nohighlight">\(u \in W^{1,2}(\Omega)\)</span>.</p></li>
</ul>
<div class="tip dropdown admonition">
<p class="admonition-title">Answer</p>
<p>We have <span class="math notranslate nohighlight">\(J(u + h) = \textstyle{\frac{1}{2}}\|\nabla u + \nabla h\|^2 = \textstyle{\frac{1}{2}}\|\nabla u\|^2 +  \int_{\Omega}\nabla u(x) \cdot \nabla h(x) \mathrm{d}x + \textstyle{\frac{1}{2}}\|\nabla h\|^2\)</span>. This suggests that <span class="math notranslate nohighlight">\(DJ(u) : U \rightarrow \mathbb{R}\)</span> can be defined as <span class="math notranslate nohighlight">\(DJ(u)v = \int_{\Omega}\nabla u(x) \cdot \nabla v(x) \mathrm{d}x\)</span>. Indeed, we can verify that</p>
<div class="math notranslate nohighlight">
\[
\lim_{\|h\|\rightarrow 0} \frac{\left| \int_{\Omega}\nabla h (x) \cdot \nabla h(x)\mathrm{d}x \right|}{\sqrt{\int_{\Omega} |h(x)|^2 + |\nabla h(x) \cdot \nabla h(x) | \mathrm{d}x}} = 0.
\]</div>
</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(J(u) = \frac{1}{2} \left\| Ku-f \right\|_{L^2(\Sigma)}^2\)</span> where <span class="math notranslate nohighlight">\(K: L^2(\Omega) \rightarrow L^2(\Sigma)\)</span> is a compact linear operator, <span class="math notranslate nohighlight">\(u : \Omega \rightarrow \mathbb{R}\)</span> and <span class="math notranslate nohighlight">\(f : \Sigma \rightarrow \mathbb{R}\)</span>.</p></li>
</ul>
<div class="tip dropdown admonition">
<p class="admonition-title">Answer</p>
<p>We have <span class="math notranslate nohighlight">\(J(u+h) = J(u) + \langle Ku - f, Kh \rangle + \textstyle{\frac{1}{2}}\|Kh\|^2.\)</span> This suggests letting <span class="math notranslate nohighlight">\(DJ(u)v = \langle Ku - f, Kh\rangle = \langle K^*(Ku - f), h\rangle\)</span>. Indeed</p>
<div class="math notranslate nohighlight">
\[
\lim_{\|h\|\rightarrow 0}\frac{\|Kh\|^2_{L^2}}{\|h\|_{L^2}} = 0,
\]</div>
<p>because <span class="math notranslate nohighlight">\(K\)</span> is bounded.</p>
</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(J(\mathbf{v}) = \frac{1}{2} \left\| \partial_t f + \nabla\cdot(f \mathbf{v}) \right\|_{L^2(\Omega \times [0,T])}^2\)</span>
where <span class="math notranslate nohighlight">\(f\)</span> here represents an image sequence, i.e. <span class="math notranslate nohighlight">\(f: \Omega \times [0,T] \rightarrow \mathbb{R}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{v}\)</span> denotes a desired vector field, i.e. <span class="math notranslate nohighlight">\(\mathbf{v}: \Omega \times [0,T] \rightarrow \mathbb{R}^2\)</span>. We assume each component of <span class="math notranslate nohighlight">\(v\)</span> satisfies <span class="math notranslate nohighlight">\(v_i(\cdot, t) \in W^{1,2}(\Omega)\)</span>.</p></li>
</ul>
<div class="tip dropdown admonition">
<p class="admonition-title">Answer</p>
<p>Here, we have <span class="math notranslate nohighlight">\(J(\mathbf{v} + \mathbf{h}) = J(\mathbf{v}) + \langle \partial_t f + \nabla \cdot (f\mathbf{v}),  \nabla \cdot (f\mathbf{h})\rangle_{L^2(\Omega \times [0,T])} + \textstyle{\frac{1}{2}}\|\nabla \cdot (f\mathbf{h})\|_{L^2(\Omega \times [0,T])}^2\)</span>, suggesting</p>
<div class="math notranslate nohighlight">
\[
DJ(\mathbf{v})\mathbf{h} = \int_0^T \int_{\Omega} \left(\partial_t f(x,t) + \nabla \cdot (f(x,t)\mathbf{v}(x,t))\right)\left(\nabla \cdot (f(x,t)\mathbf{h}(x,t))\right) \mathrm{d}t\mathrm{d}x.
\]</div>
</div>
</div>
<div class="section" id="high-order-diffusion">
<h3><span class="section-number">5.4.3. </span>High-order diffusion<a class="headerlink" href="#high-order-diffusion" title="Permalink to this headline">¶</a></h3>
<p>Consider the following denoising problem</p>
<div class="math notranslate nohighlight">
\[\min_u \textstyle{\frac{1}{2}}\|u - f^\delta\|^2_{L^2([0,1])} + \textstyle{\frac{\alpha}{2}} \|u''\|_{L^2([0,1])}^2.\]</div>
<ul class="simple">
<li><p>Show that the solution to</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\partial_t u(t,x) + u(t,x) + \alpha \partial_x^4 u(t,x) = f^\delta(x),\]</div>
<p>with boundary conditions <span class="math notranslate nohighlight">\(\partial_x u = \partial_{xxx}u = 0\)</span>, satisfies the optimality conditions of the variational problem as <span class="math notranslate nohighlight">\(t\rightarrow \infty\)</span> .</p>
<ul class="simple">
<li><p>Design an explicit finite-difference scheme to solve the diffusion equation and implement it in Python.</p></li>
<li><p>Test it on noisy data: <span class="math notranslate nohighlight">\(f^\delta(x) = \exp(-10^2(x-1/2)^2) + \epsilon\)</span>, with <span class="math notranslate nohighlight">\(\epsilon \sim N(0,\sigma^2)\)</span>.</p></li>
</ul>
<div class="tip dropdown admonition">
<p class="admonition-title">Answer</p>
<ul class="simple">
<li><p>Introduce <span class="math notranslate nohighlight">\(\phi(t) = J(u + tv)\)</span>. Then</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\phi'(0) = \int_0^1 v(x)(u(x) - f^\delta(x))\mathrm{d}x + \alpha \int_0^1 u''(x) v''(x)\mathrm{d}x.\]</div>
<p>Integrating by parts, the optimality condition <span class="math notranslate nohighlight">\(\phi'(0) = 0\)</span> reads</p>
<div class="math notranslate nohighlight">
\[ \int_0^1 v(x)(u(x) + \alpha u''''(x) - f^\delta(x))\mathrm{d}x + \text{boundary terms}.\]</div>
<p>Since it should hold for all <span class="math notranslate nohighlight">\(v\)</span>, we get the desired result.</p>
<ul class="simple">
<li><p>We use a central FD in space and Forward Euler in time:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[u^{(k+1)} = u^{(k)} + \Delta t \left(f^\delta - u^{(k)} - \alpha D u^{(k)}\right),\]</div>
<p>with <span class="math notranslate nohighlight">\(D\)</span> the finite-difference matrix. An overview of the coefficients for central FD are found <a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_coefficient">here</a>. For the central grid-points we have</p>
<div class="math notranslate nohighlight">
\[u''''(i\cdot \Delta x) \approx (u_{i-2} - 4u_{i-1} + 6u_i - 4u_{i+1} + u_{i+2})/(\Delta x)^2,\]</div>
<p>for <span class="math notranslate nohighlight">\(i = 0, 1, \ldots, n-1\)</span>. For <span class="math notranslate nohighlight">\(i=0\)</span> and <span class="math notranslate nohighlight">\(i=1\)</span> we eliminate <span class="math notranslate nohighlight">\(u_{-2}\)</span> and <span class="math notranslate nohighlight">\(u_{-1}\)</span> using the boundary conditions:</p>
<div class="math notranslate nohighlight">
\[-(1/2)u_{-2} + u_{-1} - u_1 + (1/2)u_2 = 0,\]</div>
<div class="math notranslate nohighlight">
\[(1/2)u_{-1} - (1/2)u_1 = 0.\]</div>
<p>We do the same for <span class="math notranslate nohighlight">\(i = n-2\)</span> and <span class="math notranslate nohighlight">\(i=n-1\)</span>.</p>
<ul class="simple">
<li><p>Running the code for <span class="math notranslate nohighlight">\(\Delta x = 10^{-2}\)</span>, <span class="math notranslate nohighlight">\(\Delta t = 10^{-8}\)</span>, <span class="math notranslate nohighlight">\(\alpha = 10^{-2}\)</span> on noisy data <span class="math notranslate nohighlight">\(f^\delta(x) = \exp(-10^2(x-1/2)^2) + \epsilon\)</span>, with <span class="math notranslate nohighlight">\(\epsilon \sim N(0,\sigma^2)\)</span>, <span class="math notranslate nohighlight">\(\sigma=10^{-01}\)</span> gives the following result.</p></li>
</ul>
<div class="figure align-default" id="fourth-order" style="width: 600px">
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_8_0.png" src="_images/variational_formulations_8_0.png" />
</div>
<p class="caption"><span class="caption-number">Fig. 5.4 </span><span class="caption-text">Example of denoising with fourth order diffusion.</span><a class="headerlink" href="#fourth-order" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">dia_matrix</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="k">def</span> <span class="nf">getD</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">dia_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>

    <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">D</span>


<span class="c1"># parameters</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">101</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="n">nt</span> <span class="o">=</span> <span class="mi">10001</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1e-1</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-2</span>

<span class="c1"># operator</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">getD</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>

<span class="c1"># ground truth and data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
<span class="n">u_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1e2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">f_delta</span> <span class="o">=</span> <span class="n">u_true</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

<span class="c1"># solve</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nt</span><span class="p">,</span><span class="n">nx</span><span class="p">))</span>
<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_delta</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">D</span><span class="nd">@u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">f_delta</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u_true</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$t = $&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fourth_order&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/variational_formulations_8_1.png" src="_images/variational_formulations_8_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="assignments">
<h2><span class="section-number">5.5. </span>Assignments<a class="headerlink" href="#assignments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="total-variation">
<h3><span class="section-number">5.5.1. </span>Total variation<a class="headerlink" href="#total-variation" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Derive the non-linear diffusion equation corresponding to the TV-denoising problem and design a numerical scheme method to solve it. You can assume <span class="math notranslate nohighlight">\(u \in H^{1,1}(\Omega)\)</span>.</p></li>
<li><p>Test your method on the cameraman image and compare it to the Perona-Malik approach.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="statistical_perspective.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">4. </span>A statistical perspective on inverse problems</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="numerical_optimisation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Numerical optimisation for inverse problems</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Tristan van Leeuwen and Christoph Brune (CC BY-NC 4.0)<br/>
    
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>